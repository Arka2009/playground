From caf05186174019e9cd86ec9672ddcf4337e250e5 Mon Sep 17 00:00:00 2001
From: Jiuyang Liu <liu@jiuyang.me>
Date: Tue, 24 May 2022 12:35:42 +0000
Subject: [PATCH] move stdlib.test to integration test.

---
 build.sbt                                                | 6 +-----
 build.sc                                                 | 9 +--------
 .../src/test/scala/stdlib}/BarrelShifter.scala           | 0
 3 files changed, 2 insertions(+), 13 deletions(-)
 rename {stdlib/src/test/scala/chisel3/std => integration-tests/src/test/scala/stdlib}/BarrelShifter.scala (100%)

diff --git a/build.sbt b/build.sbt
index db9dc64602..d2fc5103d4 100644
--- a/build.sbt
+++ b/build.sbt
@@ -233,6 +233,7 @@ lazy val chisel = (project in file("."))
 // tests elaborating and executing/formally verifying a Chisel circuit with chiseltest
 lazy val integrationTests = (project in file("integration-tests"))
   .dependsOn(chisel)
+  .dependsOn(standardLibrary)
   .settings(commonSettings: _*)
   .settings(chiselSettings: _*)
   .settings(usePluginSettings: _*)
@@ -248,11 +249,6 @@ lazy val standardLibrary = (project in file("stdlib"))
   .settings(commonSettings: _*)
   .settings(chiselSettings: _*)
   .settings(usePluginSettings: _*)
-  .settings(
-    Seq(
-      libraryDependencies += defaultVersions("chiseltest") % "test",
-    )
-  )
 
 lazy val docs = project // new documentation project
   .in(file("docs-target")) // important: it must not be docs/
diff --git a/build.sc b/build.sc
index 98eac795f4..7d4990ef61 100644
--- a/build.sc
+++ b/build.sc
@@ -116,13 +116,6 @@ class chisel3CrossModule(val crossScalaVersion: String) extends CommonModule wit
     override def crossScalaVersion = m.crossScalaVersion
 
     override def scalacPluginClasspath = T { m.scalacPluginClasspath() }
-
-    object test extends Tests with TestModule.ScalaTest {
-      override def moduleDeps = super.moduleDeps ++ chiseltestModule
-      override def ivyDeps = m.ivyDeps() ++ Agg(
-        v.scalatest
-      ) ++ m.chiseltestIvyDeps
-    }
   }
 
   object test extends Tests with TestModule.ScalaTest {
@@ -143,7 +136,7 @@ class chisel3CrossModule(val crossScalaVersion: String) extends CommonModule wit
       v.scalacheck
     ) ++ m.treadleIvyDeps ++ m.chiseltestIvyDeps
 
-    override def moduleDeps = super.moduleDeps ++ treadleModule ++ chiseltestModule
+    override def moduleDeps = super.moduleDeps ++ Seq(stdlib) ++ treadleModule ++ chiseltestModule
   }
 
   override def buildInfoPackageName = Some("chisel3")
diff --git a/stdlib/src/test/scala/chisel3/std/BarrelShifter.scala b/integration-tests/src/test/scala/stdlib/BarrelShifter.scala
similarity index 100%
rename from stdlib/src/test/scala/chisel3/std/BarrelShifter.scala
rename to integration-tests/src/test/scala/stdlib/BarrelShifter.scala
